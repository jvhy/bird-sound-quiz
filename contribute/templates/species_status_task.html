{% extends "base.html" %}

{% load static %}

{% load contribute_extras %}

{% load i18n %}

{% block extra_head %}
<link href="{% static 'css/style.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
{% get_current_language as LANGUAGE_CODE %}
<div class="container py-5">
    <div class="text-center pb-3">
        <h1>{% trans "SpeciesStatusTaskTitle" %}</h1>
        <p class="lead">{% trans "Region" %}: {{ region }}</p>
    </div>
    <div id="taskCarousel" class="carousel slide mx-auto" data-bs-interval="false" data-bs-touch="false" style="max-width: 400px;">
        <div class="carousel-inner">
            <div class="carousel-item active" id="slide_{{ forloop.counter }}">
                <div class="card p-4 bg-light rounded-4">
                    <div class="pb-3">
                        <div class="text-center">
                            <h4 class="pb-3">{% trans "TaskInstructionsTitle" %}</h4>
                        </div>
                        <p>{% trans "SpeciesStatusTaskInstructionsText" %}</p>
                    </div>
                </div>
            </div>
            {% for observation in observations %}
            <div class="carousel-item" id="slide_{{ forloop.counter }}">
                <div class="card p-4 bg-light rounded-4">
                    <div class="text-center pb-3">
                        <h4>{% get_localized_value observation.species "name" LANGUAGE_CODE %}</h4>
                        <p><em>{{ observation.species.name_sci }}</em></p>
                    </div>
                    <div class="row justify-content-center">
                        <div style="max-width: 300px;">
                            <div class="option-card-container">
                                {% with forloop.counter as species_counter %}
                                {% for option in options %}
                                <input
                                    type="radio"
                                    class="d-none"
                                    name="option_{{ species_counter }}"
                                    value="{{ option.0 }}"
                                    id="option{{ species_counter }}_{{ forloop.counter }}"
                                >
                                <div class="option-card" data-radio-id="option{{ species_counter }}_{{ forloop.counter }}">
                                    {{ option.1 }}
                                </div>
                                {% endfor %}
                                {% endwith %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center pt-3">
            <button class="btn btn-outline-success mx-2" data-bs-target="#taskCarousel" data-bs-slide="prev" style="width: 120px;"><i class="bi bi-arrow-left"></i>&nbsp;{% trans "PrevButtonLabel" %}</button>
            <button class="btn btn-outline-success mx-2" data-bs-target="#taskCarousel" data-bs-slide="next" style="width: 120px;">{% trans "NextButtonLabel" %}&nbsp;<i class="bi bi-arrow-right"></i></button>
        </div>
        <div class="text-center pt-3">
            <button class="btn btn-outline-primary" style="width: 90px;">{% trans "FinishTaskButtonLabel" %}</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('.option-card').forEach(card => {
            card.addEventListener('click', function () {
                const radioId = this.getAttribute('data-radio-id');
                const radio = document.getElementById(radioId);

                // Unselect other cards in the same group
                const name = radio.name;
                document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                    r.checked = false;
                    document.querySelector(`[data-radio-id="${r.id}"]`).classList.remove('selected');
                });

                // Select this one
                radio.checked = true;
                this.classList.add('selected');
            });
        });
    });
</script>
{% endblock %}